{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Groundmeas","text":"<p>Groundmeas is a toolkit for managing, analyzing, and visualizing grounding (earthing) measurements. It combines a SQLite/SQLModel data layer, a Python API, a Typer-based CLI, a Streamlit dashboard, and physics-aware analytics.</p>"},{"location":"#what-this-guide-covers","title":"What this guide covers","text":"<ul> <li>Quickstart for CLI and Python</li> <li>Data model: locations, measurements, measurement items</li> <li>Creating, reading, editing measurements</li> <li>Import/export (JSON, CSV, XML, OCR from images)</li> <li>Analytics with physical context</li> <li>Dashboard usage</li> <li>API and CLI reference</li> </ul>"},{"location":"#physical-background","title":"Physical background","text":""},{"location":"#earthing-impedance","title":"Earthing impedance","text":"<p>Ratio of Earth Potential Rise (EPR) to injected earthing current.</p> \\[ Z_E(f) = \\frac{V_{EPR}(f)}{I_E(f)} \\]"},{"location":"#earth-potential-rise-epr","title":"Earth Potential Rise (EPR)","text":"<p>Voltage rise of the grounding system during a fault.</p> \\[ EPR = Z_E \\cdot I_E \\] <p>Touch voltages (prospective and actual) stem from the same quantities and must be checked against safety limits.</p>"},{"location":"#soil-resistivity","title":"Soil resistivity","text":"<p>Soil resistivity (rho) varies with depth and frequency and strongly influences grounding behavior. Wenner or Schlumberger arrays are typical; readings are stored as <code>soil_resistivity</code> items.</p>"},{"location":"#rhof-model","title":"Rho\u2013f model","text":"<p>Empirical model for impedance as a function of soil resistivity and frequency.</p> \\[ Z(\\rho, f) = k_1 \\cdot \\rho + (k_2 + j k_3) \\cdot f + (k_4 + j k_5) \\cdot \\rho \\cdot f \\] <p>Coefficients k1..k5 are fitted from measured impedance and resistivity.</p>"},{"location":"#fall-of-potential-reduction","title":"Fall-of-Potential reduction","text":"<p>To extract a characteristic value from a distance\u2013impedance (or voltage) profile, groundmeas offers: - Maximum - 62% interpolation - Minimum gradient - Minimum standard deviation (sliding window) - Inverse extrapolation</p> <p>See <code>15_analytics.md</code> for guidance on when to use each method.</p>"},{"location":"#navigation","title":"Navigation","text":"<ul> <li>Quickstart: <code>02_quickstart.md</code></li> <li>Tutorials: <code>10_tutorial_intro.md</code> and subsequent files</li> <li>Reference: <code>20_ref_intro.md</code>, <code>21_ref_api.md</code>, <code>22_ref_cli.md</code></li> </ul>"},{"location":"00_index/","title":"Groundmeas","text":"<p>Groundmeas is a toolkit for managing, analyzing, and visualizing grounding (earthing) measurements. It combines a SQLite/SQLModel data layer, a Python API, a Typer-based CLI, a Streamlit dashboard, and physics-aware analytics.</p>"},{"location":"00_index/#what-this-guide-covers","title":"What this guide covers","text":"<ul> <li>Quickstart for CLI and Python</li> <li>Data model: locations, measurements, measurement items</li> <li>Creating, reading, editing measurements</li> <li>Import/export (JSON, CSV, XML, OCR from images)</li> <li>Analytics with physical context</li> <li>Dashboard usage</li> <li>API and CLI reference</li> </ul>"},{"location":"00_index/#physical-background","title":"Physical background","text":""},{"location":"00_index/#earthing-impedance","title":"Earthing impedance","text":"<p>Ratio of Earth Potential Rise (EPR) to injected earthing current.</p> \\[ Z_E(f) = \\frac{V_{EPR}(f)}{I_E(f)} \\]"},{"location":"00_index/#earth-potential-rise-epr","title":"Earth Potential Rise (EPR)","text":"<p>Voltage rise of the grounding system during a fault.</p> \\[ EPR = Z_E \\cdot I_E \\] <p>Touch voltages (prospective and actual) stem from the same quantities and must be checked against safety limits.</p>"},{"location":"00_index/#soil-resistivity","title":"Soil resistivity","text":"<p>Soil resistivity (rho) varies with depth and frequency and strongly influences grounding behavior. Wenner or Schlumberger arrays are typical; readings are stored as <code>soil_resistivity</code> items.</p>"},{"location":"00_index/#rhof-model","title":"Rho\u2013f model","text":"<p>Empirical model for impedance as a function of soil resistivity and frequency.</p> \\[ Z(\\rho, f) = k_1 \\cdot \\rho + (k_2 + j k_3) \\cdot f + (k_4 + j k_5) \\cdot \\rho \\cdot f \\] <p>Coefficients k1..k5 are fitted from measured impedance and resistivity.</p>"},{"location":"00_index/#fall-of-potential-reduction","title":"Fall-of-Potential reduction","text":"<p>To extract a characteristic value from a distance\u2013impedance (or voltage) profile, groundmeas offers: - Maximum - 62% interpolation - Minimum gradient - Minimum standard deviation (sliding window) - Inverse extrapolation</p> <p>See <code>15_analytics.md</code> for guidance on when to use each method.</p>"},{"location":"00_index/#navigation","title":"Navigation","text":"<ul> <li>Quickstart: <code>02_quickstart.md</code></li> <li>Tutorials: <code>10_tutorial_intro.md</code> and subsequent files</li> <li>Reference: <code>20_ref_intro.md</code>, <code>21_ref_api.md</code>, <code>22_ref_cli.md</code></li> </ul>"},{"location":"01_datamodels/","title":"Data models","text":"<p>Groundmeas stores data in SQLite via SQLModel with three core entities: Location, Measurement, and MeasurementItem. The relationships are simple: - A Location can have many Measurements. - A Measurement belongs to one Location (optional) and has many MeasurementItems. - A MeasurementItem always belongs to one Measurement.</p>"},{"location":"01_datamodels/#location","title":"Location","text":"<ul> <li><code>id</code> (int, PK)</li> <li><code>name</code> (str)</li> <li><code>latitude</code>, <code>longitude</code>, <code>altitude</code> (float, optional)</li> <li>Back-reference: <code>measurements</code></li> </ul>"},{"location":"01_datamodels/#measurement","title":"Measurement","text":"<ul> <li><code>id</code> (int, PK)</li> <li><code>timestamp</code> (UTC, auto)</li> <li><code>location_id</code> / <code>location</code> (FK to <code>Location</code>, optional)</li> <li><code>method</code>: <code>staged_fault_test</code> | <code>injection_remote_substation</code> | <code>injection_earth_electrode</code></li> <li><code>asset_type</code>: <code>substation</code> | <code>overhead_line_tower</code> | <code>cable</code> | <code>cable_cabinet</code> | <code>house</code> | <code>pole_mounted_transformer</code> | <code>mv_lv_earthing_system</code></li> <li><code>voltage_level_kv</code>, <code>fault_resistance_ohm</code> (optional)</li> <li><code>operator</code>, <code>description</code> (optional)</li> <li><code>items</code>: list of <code>MeasurementItem</code></li> </ul>"},{"location":"01_datamodels/#measurementitem","title":"MeasurementItem","text":"<p>Supports polar or rectangular representation; the model enforces consistency with an event hook. - <code>id</code> (int, PK) - <code>measurement_id</code> / <code>measurement</code> (FK to <code>Measurement</code>) - <code>measurement_type</code>:   - Voltages/potentials: <code>prospective_touch_voltage</code>, <code>touch_voltage</code>, <code>earth_potential_rise</code>, <code>step_voltage</code>, <code>transferred_potential</code>   - Currents: <code>earth_fault_current</code>, <code>earthing_current</code>, <code>shield_current</code>   - Impedance/resistance: <code>earthing_resistance</code>, <code>earthing_impedance</code>   - Soil: <code>soil_resistivity</code> - Value fields (polar): <code>value</code>, <code>value_angle_deg</code> - Value fields (rectangular): <code>value_real</code>, <code>value_imag</code> - Metadata: <code>unit</code>, <code>frequency_hz</code>, <code>measurement_distance_m</code>, <code>distance_to_current_injection_m</code>, <code>additional_resistance_ohm</code>, <code>input_impedance_ohm</code>, <code>description</code></p>"},{"location":"01_datamodels/#consistency-rules","title":"Consistency rules","text":"<ul> <li>If only <code>value_real</code>/<code>value_imag</code> are provided, magnitude and angle are computed automatically.</li> <li>If <code>value</code> and <code>value_angle_deg</code> are provided, real/imag parts are computed.</li> <li>At least one representation must be present or insertion raises <code>ValueError</code>.</li> </ul>"},{"location":"01_datamodels/#relationships-and-usage","title":"Relationships and usage","text":"<ul> <li>A <code>Measurement</code> can exist without a <code>Location</code>, but typical workflows create both.</li> <li>Items are always attached to a <code>Measurement</code>.</li> <li>The CLI and API mirror this structure: create a measurement (optionally with location), then create items.</li> </ul>"},{"location":"02_quickstart/","title":"Quickstart (CLI and Python)","text":"<p>Goal: create a database, add a measurement with 10 earthing-impedance items at different distances, read data, import/export JSON, run analytics with two methods, and plot impedance vs distance.</p>"},{"location":"02_quickstart/#cli-route","title":"CLI route","text":"<pre><code># 1) Create/connect a database (auto-created)\ngm-cli --db ./groundmeas.db list-measurements\n\n# 2) Add a measurement interactively (location, method, asset, etc.)\ngm-cli --db ./groundmeas.db add-measurement\n</code></pre> <pre><code># 3) Add 10 earthing_impedance items with varying distance\nfor d in 10 20 30 40 50 60 70 80 90 100; do\n  gm-cli --db ./groundmeas.db add-item MEAS_ID \\\n    --type earthing_impedance \\\n    # you'll be prompted for frequency/value/angle; enter e.g. 50 Hz and a magnitude\n    # enter measurement distance m when prompted (use $d)\ndone\n</code></pre> <pre><code># 4) Read back items\ngm-cli --db ./groundmeas.db list-items MEAS_ID\n\n# 5) Import from JSON (file or folder)\ngm-cli --db ./groundmeas.db import-json data/example_measurement.json\n\n# 6) Export to JSON\ngm-cli --db ./groundmeas.db export-json export/out.json --measurement-id MEAS_ID\n\n# 7) Analytics: distance-profile with two methods\ngm-cli --db ./groundmeas.db distance-profile MEAS_ID --type earthing_impedance --algorithm maximum\ngm-cli --db ./groundmeas.db distance-profile MEAS_ID --type earthing_impedance --algorithm minimum_gradient\n\n# 8) Plot impedance vs distance (static)\ngm-cli --db ./groundmeas.db plot-impedance MEAS_ID --out plots/impedance.png\n</code></pre>"},{"location":"02_quickstart/#python-route","title":"Python route","text":"<pre><code>from groundmeas.db import connect_db, create_measurement, create_item, read_items_by\nfrom groundmeas.analytics import distance_profile_value, value_over_distance\nfrom groundmeas.plots import plot_value_over_distance\n\n# 1) Connect DB\nconnect_db(\"groundmeas.db\")\n\n# 2) Create a measurement with a location\nmid = create_measurement({\n    \"method\": \"staged_fault_test\",\n    \"asset_type\": \"substation\",\n    \"voltage_level_kv\": 10.0,\n    \"fault_resistance_ohm\": 1.0,\n    \"description\": \"Quickstart example\",\n    \"location\": {\"name\": \"Site A\", \"latitude\": 51.0, \"longitude\": 10.0}\n})\n\n# 3) Add 10 earthing_impedance items\nfor idx, dist in enumerate(range(10, 110, 10)):\n    create_item({\n        \"measurement_type\": \"earthing_impedance\",\n        \"frequency_hz\": 50.0,\n        \"value\": 0.3 + 0.02 * idx,   # sample magnitudes\n        \"value_angle_deg\": 0.0,\n        \"unit\": \"\u03a9\",\n        \"measurement_distance_m\": float(dist),\n        \"distance_to_current_injection_m\": 150.0,\n    }, measurement_id=mid)\n\n# 4) Read items back\nitems, _ = read_items_by(measurement_id=mid, measurement_type=\"earthing_impedance\")\nprint(items)\n\n# 5) Import / Export (helpers)\nfrom groundmeas.export import export_measurements_to_json\nexport_measurements_to_json(\"export/out.json\", id__in=[mid])\n\n# 6) Analytics with two methods\nres_max = distance_profile_value(mid, algorithm=\"maximum\")\nres_grad = distance_profile_value(mid, algorithm=\"minimum_gradient\")\nprint(\"Maximum:\", res_max[\"result_value\"], res_max[\"result_distance_m\"])\nprint(\"Min gradient:\", res_grad[\"result_value\"], res_grad[\"result_distance_m\"])\n\n# 7) Plot impedance vs distance (Matplotlib)\nfig = plot_value_over_distance(mid, measurement_type=\"earthing_impedance\")\nfig.savefig(\"plots/impedance_distance.png\")\n</code></pre> <p>Next steps: see the tutorials for deeper workflows and the reference files for full argument lists.</p>"},{"location":"10_tutorial_intro/","title":"Tutorials overview","text":"<p>This section walks through realistic workflows: - Creating measurements (CLI and Python): see <code>11_create_measurements.md</code> - Reading and inspecting data: see <code>12_read_measurements.md</code> - Editing existing records: see <code>13_change_measurements.md</code> - Import/export, including OCR from images: see <code>14_import_export.md</code> - Analytics with physical background: see <code>15_analytics.md</code> - Dashboard usage: see <code>16_dashboard.md</code></p> <p>Each tutorial pairs CLI and Python examples using real-world values (e.g., a 20 kV substation staged fault test with Fall-of-Potential points at 10\u2013150 m). Follow in order for onboarding or jump to what you need.</p>"},{"location":"11_create_measurements/","title":"Create measurements","text":"<p>Real-world scenario: staged fault test at a 20 kV substation with Fall-of-Potential points (10\u2013150 m) and shield current capture.</p>"},{"location":"11_create_measurements/#cli-field-entry","title":"CLI (field entry)","text":"Task Command Notes/arguments Create measurement <code>gm-cli add-measurement</code> Enter location (e.g., \u201cSubstation West\u201d, lat/lon), method <code>staged_fault_test</code>, asset <code>substation</code>, <code>voltage_level_kv=20</code>, <code>fault_resistance_ohm=1</code>, operator, notes. Add initial items in the wizard or later. Add impedance points <code>gm-cli add-item MEAS_ID</code> For each distance (10, 30, 50, \u2026, 150 m): choose <code>earthing_impedance</code>, set <code>frequency_hz=50</code>, value/angle or real/imag, <code>measurement_distance_m</code>, <code>distance_to_current_injection_m</code> (e.g., 200 m). Add shield current <code>gm-cli add-item MEAS_ID</code> Type <code>shield_current</code>, <code>frequency_hz=50</code>, magnitude/angle or real/imag, unit <code>A</code>. <p>Tips: Use <code>--db PATH</code> or <code>GROUNDMEAS_DB</code>. Autocomplete reuses prior locations/operators/units.</p>"},{"location":"11_create_measurements/#python-api-scripted","title":"Python API (scripted)","text":"<pre><code>from groundmeas.db import connect_db, create_measurement, create_item\n\nconnect_db(\"groundmeas.db\")\n\n# Measurement metadata\nmid = create_measurement({\n    \"method\": \"staged_fault_test\",\n    \"asset_type\": \"substation\",\n    \"voltage_level_kv\": 20.0,\n    \"fault_resistance_ohm\": 1.0,\n    \"operator\": \"Ops Team\",\n    \"description\": \"Staged fault, Substation West\",\n    \"location\": {\"name\": \"Substation West\", \"latitude\": 50.12, \"longitude\": 8.65}\n})\n\n# Fall-of-Potential impedance points\ndistances = [10, 30, 50, 70, 90, 110, 130, 150]\nfor idx, dist in enumerate(distances):\n    create_item({\n        \"measurement_type\": \"earthing_impedance\",\n        \"frequency_hz\": 50.0,\n        \"value\": 0.35 + 0.01 * idx,   # sample increasing values\n        \"value_angle_deg\": 0.0,\n        \"unit\": \"\u03a9\",\n        \"measurement_distance_m\": float(dist),\n        \"distance_to_current_injection_m\": 200.0,\n    }, measurement_id=mid)\n\n# Shield current at 50 Hz\ncreate_item({\n    \"measurement_type\": \"shield_current\",\n    \"frequency_hz\": 50.0,\n    \"value\": 45.0,\n    \"value_angle_deg\": -10.0,\n    \"unit\": \"A\",\n}, measurement_id=mid)\n</code></pre>"},{"location":"11_create_measurements/#supported-item-types-measurement_type","title":"Supported item types (measurement_type)","text":"Category Types Impedance/resistance <code>earthing_impedance</code>, <code>earthing_resistance</code> Currents <code>earth_fault_current</code>, <code>earthing_current</code>, <code>shield_current</code> Voltages/potentials <code>prospective_touch_voltage</code>, <code>touch_voltage</code>, <code>earth_potential_rise</code>, <code>step_voltage</code>, <code>transferred_potential</code> Soil <code>soil_resistivity</code>"},{"location":"11_create_measurements/#value-representations","title":"Value representations","text":"Representation Fields Notes Polar <code>value</code>, <code>value_angle_deg</code> Magnitude and optional phase angle. Rectangular <code>value_real</code>, <code>value_imag</code> Real/imag parts; magnitude/angle auto-computed. <p>The model auto-computes the missing counterpart. At least one representation is required.</p>"},{"location":"11_create_measurements/#recommended-metadata","title":"Recommended metadata","text":"Field Why <code>frequency_hz</code> Aligns impedance/current/voltage for analysis. <code>measurement_distance_m</code> Needed for Fall-of-Potential and soil profiles. <code>distance_to_current_injection_m</code> Required for the 62% algorithm. <code>unit</code> Always set (<code>\u03a9</code>, <code>A</code>, <code>V</code>, <code>m</code>, etc.)."},{"location":"12_read_measurements/","title":"Read measurements","text":"<p>Scenario continuation: inspect the staged fault test data, check impedance values, and verify shield currents.</p>"},{"location":"12_read_measurements/#cli","title":"CLI","text":"Task Command Notes List measurements <code>gm-cli list-measurements</code> Shows <code>[id] location | method | asset | items</code>. View items <code>gm-cli list-items MEAS_ID [--type earthing_impedance]</code> Tabular view of impedance points with frequency/value/angle/distance/unit. Export for review <code>gm-cli export-json out.json --measurement-id MEAS_ID</code> JSON snapshot for offline QA. Quick profile check <code>gm-cli distance-profile MEAS_ID --type earthing_impedance --algorithm minimum_gradient</code> Returns characteristic value from the curve."},{"location":"12_read_measurements/#python-api","title":"Python API","text":"<pre><code>from groundmeas.db import connect_db, read_measurements_by, read_items_by\nconnect_db(\"groundmeas.db\")\n\n# All measurements\nmeasurements, ids = read_measurements_by()\n\n# Get one measurement with items\nm, _ = read_measurements_by(id=ids[0])\nprint(m[0][\"location\"], len(m[0][\"items\"]))\n\n# Items filtered by type and frequency\nimpedance_items, _ = read_items_by(\n    measurement_id=ids[0],\n    measurement_type=\"earthing_impedance\",\n    frequency_hz=50.0\n)\n\n# Verify shield currents at 50 Hz\nshield_items, _ = read_items_by(\n    measurement_id=ids[0],\n    measurement_type=\"shield_current\",\n    frequency_hz=50.0\n)\nprint(\"Shield currents:\", shield_items)\n</code></pre>"},{"location":"12_read_measurements/#filter-suffixes-you-can-use","title":"Filter suffixes you can use","text":"<ul> <li>Equality (default): <code>field=value</code></li> <li><code>__lt</code>, <code>__lte</code>, <code>__gt</code>, <code>__gte</code> for ranges</li> <li><code>__in</code> for list membership</li> <li><code>__ne</code> for inequality</li> </ul> <p>Examples: - <code>read_measurements_by(asset_type=\"substation\", voltage_level_kv__gte=10)</code> - <code>read_items_by(measurement_id=5, measurement_type=\"earthing_current\")</code> - <code>read_items_by(frequency_hz__gte=1000)</code></p>"},{"location":"13_change_measurements/","title":"Change measurements","text":"<p>Scenario continuation: adjust impedance values after a retest and remove an erroneous point.</p>"},{"location":"13_change_measurements/#cli","title":"CLI","text":"Task Command Notes Edit measurement metadata <code>gm-cli edit-measurement MEAS_ID</code> Update description, operator, voltage, method, location. Edit an item <code>gm-cli edit-item ITEM_ID</code> Auto-detects polar vs rectangular. Change value, frequency, distance, unit, description. Delete an item <code>gm-cli delete-item ITEM_ID [--yes/-y]</code> Remove an erroneous data point. Delete a measurement <code>gm-cli delete-measurement MEAS_ID [--yes/-y]</code> Removes the measurement and its items."},{"location":"13_change_measurements/#python-api","title":"Python API","text":"<pre><code>from groundmeas.db import connect_db, update_measurement, update_item, delete_item\nconnect_db(\"groundmeas.db\")\n\n# Update measurement description and voltage\nupdate_measurement(1, {\n    \"description\": \"Retested after maintenance\",\n    \"voltage_level_kv\": 18.0,\n})\n\n# Convert an impedance point to rectangular form\nupdate_item(10, {\n    \"measurement_type\": \"earthing_impedance\",\n    \"frequency_hz\": 50.0,\n    \"value\": None,\n    \"value_angle_deg\": None,\n    \"value_real\": 0.28,\n    \"value_imag\": 0.04,\n    \"unit\": \"\u03a9\",\n    \"measurement_distance_m\": 70.0,\n})\n\n# Delete an outlier item\ndelete_item(11)\n</code></pre>"},{"location":"13_change_measurements/#tips","title":"Tips","text":"<ul> <li>When switching representations, set the unused fields to <code>None</code> to avoid stale values.</li> <li>Keep frequencies consistent for comparable datasets.</li> <li>Use <code>--yes/-y</code> flags in CLI when scripting to skip confirmations.</li> </ul>"},{"location":"14_import_export/","title":"Import and export","text":"<p>Scenario continuation: archive the staged fault test, share data, and ingest additional measurements from JSON and images.</p>"},{"location":"14_import_export/#cli","title":"CLI","text":"Task Command Notes Import JSON <code>gm-cli import-json PATH</code> File, folder, or split pairs <code>_measurement.json</code> + <code>_items.json</code>. Export JSON <code>gm-cli export-json OUT.json --measurement-id MEAS_ID ...</code> Export selected measurements with items. OCR import from images <code>gm-cli import-from-images MEAS_ID IMAGES_DIR --type earthing_impedance --frequency 50 --ocr tesseract --injection-distance 200</code> Use <code>--frequency dir</code> to read freq from subfolders; switch OCR provider with <code>--ocr openai:&lt;model&gt;</code> or <code>--ocr ollama:&lt;model&gt;</code>. <p>Example (pull new site data): <pre><code>gm-cli import-json data/new_site/\ngm-cli export-json export/sub_west.json --measurement-id 1\ngm-cli import-from-images 1 ./images/sub_west --type earthing_impedance --frequency dir --ocr tesseract\n</code></pre></p>"},{"location":"14_import_export/#python-api","title":"Python API","text":"<pre><code>from groundmeas.db import connect_db\nfrom groundmeas.export import export_measurements_to_json, export_measurements_to_csv, export_measurements_to_xml\nfrom groundmeas.vision_import import import_items_from_images\n\nconnect_db(\"groundmeas.db\")\n\n# Export selected measurements\nexport_measurements_to_json(\"export/sub_west.json\", id__in=[1])\nexport_measurements_to_csv(\"export/sub_west.csv\", id__in=[1])\nexport_measurements_to_xml(\"export/sub_west.xml\", id__in=[1])\n\n# OCR import for another measurement\nsummary = import_items_from_images(\n    images_dir=\"images/sub_west\",\n    measurement_id=1,\n    measurement_type=\"earthing_impedance\",\n    frequency_hz=\"dir\",\n    distance_to_current_injection_m=200.0,\n    ocr_provider=\"tesseract\",\n)\nprint(summary)\n</code></pre>"},{"location":"14_import_export/#ocr-notes","title":"OCR notes","text":"<ul> <li>For OpenAI models, set <code>OPENAI_API_KEY</code> or pass <code>api_key_env</code>.</li> <li><code>ocr_max_dim</code> can downscale images for cloud OCR efficiency.</li> <li>The importer deduplicates impedance by distance, median-filters currents when stable, and estimates prospective touch voltage near 1 m.</li> </ul>"},{"location":"14_import_export/#file-format-tips","title":"File format tips","text":"<ul> <li>JSON export is lossless and includes nested items and location.</li> <li>CSV export stores items as a JSON string column\u2014best for spreadsheets, not round-trips.</li> <li>XML export nests items under each measurement. </li> </ul>"},{"location":"15_analytics/","title":"Analytics","text":"<p>Groundmeas provides physics-aware analytics for impedance profiles, touch voltages, shield currents, and model fitting. Functions are available via both the Python API (<code>groundmeas.analytics</code>) and CLI commands.</p>"},{"location":"15_analytics/#core-formulas","title":"Core formulas","text":"<p>Earthing impedance:</p> \\[ Z_E(f) = \\frac{V_{EPR}(f)}{I_E(f)} \\] <p>Earth Potential Rise:</p> \\[ EPR = Z_E \\cdot I_E \\] <p>Rho\u2013f model:</p> \\[ Z(\\rho, f) = k_1 \\cdot \\rho + (k_2 + j k_3) \\cdot f + (k_4 + j k_5) \\cdot \\rho \\cdot f \\] <p>Inverse extrapolation (Fall-of-Potential):</p> \\[ \\frac{1}{Z} = a \\cdot \\frac{1}{d} + b \\]"},{"location":"15_analytics/#distance-profile-reduction","title":"Distance profile reduction","text":"<p>Function: <code>distance_profile_value(measurement_id, measurement_type=\"earthing_impedance\", algorithm=..., window=3)</code></p> <p>Algorithms and when to use them: - <code>maximum</code>: conservative; picks the largest measured value. - <code>62_percent</code>: classic Fall-of-Potential for homogeneous soil; needs <code>distance_to_current_injection_m</code>. - <code>minimum_gradient</code>: finds the flattest segment (|dZ/dd| minimal); good for mildly noisy curves. - <code>minimum_stddev</code>: sliding window with lowest variance, then takes its peak; robust to noise/outliers. - <code>inverse</code>: fits the inverse relation above and evaluates at infinite distance; use when measurements extend far from the electrode.</p> <p>CLI: <code>gm-cli distance-profile MEAS_ID --type earthing_impedance --algorithm minimum_gradient</code></p>"},{"location":"15_analytics/#impedance-and-realimag-over-frequency","title":"Impedance and real/imag over frequency","text":"<p>Functions: - <code>impedance_over_frequency(measurement_ids)</code> - <code>real_imag_over_frequency(measurement_ids)</code></p> <p>CLI: - <code>gm-cli impedance-over-frequency MEAS_ID [--json-out file]</code> - <code>gm-cli real-imag-over-frequency MEAS_ID [--json-out file]</code></p> <p>Use cases: plotting Bode-like curves, preparing data for the rho\u2013f fit, comparing multiple measurements.</p>"},{"location":"15_analytics/#rhof-fitting","title":"Rho\u2013f fitting","text":"<p>Function: <code>rho_f_model(measurement_ids)</code> \u2192 <code>(k1, k2, k3, k4, k5)</code></p> <p>Requirements: overlapping impedance data (real/imag) and soil resistivity items. The least-squares fit enforces a real impedance at f=0 via the k1\u00b7rho term.</p> <p>CLI: <code>gm-cli rho-f-model ID1 ID2 ... [--json-out file]</code></p>"},{"location":"15_analytics/#touch-voltages-and-epr","title":"Touch voltages and EPR","text":"<p>Function: <code>voltage_vt_epr(measurement_ids, frequency=50)</code></p> <p>Inputs: - <code>earthing_impedance</code> at the specified frequency - <code>earthing_current</code> at the same frequency - Optional: <code>prospective_touch_voltage</code>, <code>touch_voltage</code></p> <p>Outputs per measurement: - <code>epr</code> - <code>vtp_min</code>, <code>vtp_max</code> (if prospective touch voltage present) - <code>vt_min</code>, <code>vt_max</code> (if touch voltage present)</p> <p>CLI: <code>gm-cli voltage-vt-epr MEAS_ID --frequency 50 [--json-out file]</code></p>"},{"location":"15_analytics/#shield-currents-and-split-factor","title":"Shield currents and split factor","text":"<p>Functions: - <code>shield_currents_for_location(location_id, frequency_hz=None)</code> - <code>calculate_split_factor(earth_fault_current_id, shield_current_ids)</code></p> <p>Purpose: quantify how much of the earth fault current is diverted through cable shields versus the local earthing system.</p> <p>CLI: - <code>gm-cli shield-currents LOCATION_ID [--frequency Hz]</code> - <code>gm-cli calculate-split-factor --earth-fault-id ID --shield-id ID1 --shield-id ID2 ...</code></p> <p>Output includes magnitude/angle and real/imag components for shield sum, earth fault current, and local earthing current, plus the split factor.</p>"},{"location":"15_analytics/#distance-based-mappings","title":"Distance-based mappings","text":"<p>Functions: - <code>value_over_distance(measurement_ids, measurement_type=\"earthing_impedance\")</code> - <code>value_over_distance_detailed(...)</code></p> <p>Use for plotting Fall-of-Potential or soil profiles. See plotting helpers below.</p>"},{"location":"15_analytics/#plotting-helpers-analytics-outputs","title":"Plotting helpers (analytics outputs)","text":"<ul> <li><code>plot_imp_over_f</code>, <code>plot_rho_f_model</code>, <code>plot_voltage_vt_epr</code>, <code>plot_value_over_distance</code> (Matplotlib)</li> <li>Plotly equivalents in <code>groundmeas.vis_plotly</code> for interactive use and in the dashboard.</li> </ul> <p>CLI plot commands: - <code>plot-impedance</code> - <code>plot-rho-f-model</code> - <code>plot-voltage-vt-epr</code></p>"},{"location":"15_analytics/#example-python","title":"Example (Python)","text":"<pre><code>from groundmeas.db import connect_db\nfrom groundmeas.analytics import (\n    distance_profile_value,\n    impedance_over_frequency,\n    rho_f_model,\n    voltage_vt_epr,\n)\n\nconnect_db(\"groundmeas.db\")\n\ndp = distance_profile_value(1, measurement_type=\"earthing_impedance\", algorithm=\"minimum_gradient\")\nprint(\"Characteristic impedance:\", dp[\"result_value\"], \"at\", dp[\"result_distance_m\"], \"m\")\n\nimp = impedance_over_frequency([1,2])\ncoeffs = rho_f_model([1,2])\nprint(\"Rho\u2013f coefficients:\", coeffs)\n\nvt = voltage_vt_epr(1, frequency=50.0)\nprint(\"EPR and touch voltages:\", vt)\n</code></pre>"},{"location":"16_dashboard/","title":"Dashboard","text":"<p>The Streamlit dashboard provides interactive exploration, plotting, and map-based selection of measurements.</p>"},{"location":"16_dashboard/#launch","title":"Launch","text":"<p><pre><code>gm-cli dashboard\n</code></pre> The command resolves the database path in this order: <code>GROUNDMEAS_DB</code>, <code>~/.config/groundmeas/config.json</code>, then <code>./groundmeas.db</code>.</p>"},{"location":"16_dashboard/#layout","title":"Layout","text":"<ul> <li>Sidebar filters: multi-select asset types; shows how many measurements match.</li> <li>Map: Folium map with color-coded markers (e.g., red for substations, green for towers). Click a marker to select a measurement. Enable \u201cMulti-select mode\u201d to add multiple sites without replacing the previous selection.</li> <li>Selection list: multiselect widget listing current selection by measurement ID.</li> <li>Tabs:</li> <li>Measurement Items: JSON view of the selected measurement(s) and a table of items (ID, type, value, unit, frequency, distance).</li> <li>Impedance vs Frequency: Plotly chart of |Z| over frequency for the selection; click \u201cGenerate Impedance Plot\u201d.</li> <li>Rho-f Model: Fits coefficients for the selection, displays them, and overlays model curves on measured data.</li> <li>Voltage / EPR: Bar chart for EPR, prospective touch voltage (min/max), and touch voltage (min/max) at a chosen frequency.</li> <li>Value vs Distance: Distance plots for impedance/resistance/soil resistivity. Optionally show all frequencies or choose one frequency to filter.</li> </ul>"},{"location":"16_dashboard/#tips","title":"Tips","text":"<ul> <li>Keep a consistent <code>frequency_hz</code> across related impedance/current/voltage items so plots and analytics align.</li> <li>Ensure items include <code>measurement_distance_m</code> when you want Fall-of-Potential or soil profile plots.</li> <li>Use the CLI to add or adjust data while the dashboard is open; refresh the browser to reload.</li> </ul>"},{"location":"16_dashboard/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>If the dashboard cannot connect to the DB, check <code>GROUNDMEAS_DB</code> or the config file and rerun.</li> <li>For missing data warnings in plots, confirm that items of the requested type and frequency exist.</li> </ul>"},{"location":"20_ref_intro/","title":"Reference overview","text":"<p>Use the reference section when you need exact signatures, arguments, and behavior.</p> <ul> <li><code>21_ref_api.md</code>: Python API reference (all public functions and helpers).</li> <li><code>22_ref_cli.md</code>: CLI reference (every Typer command with arguments and behavior).</li> </ul> <p>Tip: All database operations require <code>groundmeas.db.connect_db(path)</code> once per process. The CLI resolves the path automatically; Python code must call it explicitly.</p>"},{"location":"21_ref_api/","title":"API Reference","text":"<p>Docstrings follow the pandas/PEP 257 convention. Call <code>groundmeas.db.connect_db(path)</code> once per process before using database-backed functions.</p>"},{"location":"21_ref_api/#database-groundmeasdb","title":"Database (<code>groundmeas.db</code>)","text":"Function Description Key args/notes <code>connect_db(path, echo=False)</code> Initialize/open SQLite; create tables. <code>path</code> file path; <code>echo</code> log SQL <code>create_measurement(data)</code> Insert measurement (optional nested <code>location</code>). Returns ID. <code>create_item(data, measurement_id)</code> Insert item linked to a measurement. Returns ID. <code>read_measurements(where=None)</code> Raw WHERE string; returns records + IDs (with items, location). <code>read_measurements_by(**filters)</code> Filtered read; supports <code>__lt/__lte/__gt/__gte/__in/__ne</code>. <code>read_items_by(**filters)</code> Filtered read for items; same suffix rules. <code>update_measurement(measurement_id, updates)</code> Update measurement (nested <code>location</code> allowed). Returns bool <code>update_item(item_id, updates)</code> Update one item. Returns bool <code>delete_measurement(measurement_id)</code> Delete measurement and items. Returns bool <code>delete_item(item_id)</code> Delete one item. Returns bool"},{"location":"21_ref_api/#models-groundmeasmodels","title":"Models (<code>groundmeas.models</code>)","text":"Object Key fields Notes <code>Location</code> <code>id</code>, <code>name</code>, <code>latitude</code>, <code>longitude</code>, <code>altitude</code>, <code>measurements</code> Site metadata <code>Measurement</code> <code>id</code>, <code>timestamp</code>, <code>location</code>, <code>method</code>, <code>asset_type</code>, <code>voltage_level_kv</code>, <code>fault_resistance_ohm</code>, <code>operator</code>, <code>description</code>, <code>items</code> Event tied to a location <code>MeasurementItem</code> <code>id</code>, <code>measurement_id</code>, <code>measurement_type</code>, <code>value</code>, <code>value_angle_deg</code>, <code>value_real</code>, <code>value_imag</code>, <code>unit</code>, <code>frequency_hz</code>, <code>measurement_distance_m</code>, <code>distance_to_current_injection_m</code>, <code>additional_resistance_ohm</code>, <code>input_impedance_ohm</code>, <code>description</code> Data point with polar/rectangular support <code>_compute_magnitude</code> Auto-computes missing polar/rectangular parts; raises <code>ValueError</code> if neither is present. SQLAlchemy event"},{"location":"21_ref_api/#analytics-groundmeasanalytics","title":"Analytics (<code>groundmeas.analytics</code>)","text":"Function Description Key args/notes <code>impedance_over_frequency(measurement_ids)</code> Map freq \u2192 |Z| (or per measurement). Accepts single ID or list <code>real_imag_over_frequency(measurement_ids)</code> Map freq \u2192 <code>{real, imag}</code> (or per measurement). <code>distance_profile_value(measurement_id, measurement_type=\"earthing_impedance\", algorithm=\"maximum\", window=3)</code> Reduce distance\u2013value profile via algorithm (<code>maximum</code>, <code>62_percent</code>, <code>minimum_gradient</code>, <code>minimum_stddev</code>, <code>inverse</code>). Inverse fits <code>1/Z = a*(1/d) + b</code> <code>rho_f_model(measurement_ids)</code> Fit rho\u2013f coefficients <code>(k1..k5)</code> using impedance (real/imag) + soil resistivity. Requires overlap in freq <code>voltage_vt_epr(measurement_ids, frequency=50)</code> EPR and touch/prospective voltages per ampere. Needs impedance + current at <code>frequency</code> <code>shield_currents_for_location(location_id, frequency_hz=None)</code> List shield-current items for a location. Optional frequency filter <code>calculate_split_factor(earth_fault_current_id, shield_current_ids)</code> Compute split factor and vector sums (mag/angle/real/imag). Provide shield IDs with consistent reference <code>value_over_distance(measurement_ids, measurement_type=\"earthing_impedance\")</code> Map distance \u2192 value (or per measurement). <code>value_over_distance_detailed(...)</code> List of <code>{distance, value, frequency}</code> (or dict per measurement). <code>_current_item_to_complex(item)</code> Convert an item to a complex current (A). Prefers real/imag, else magnitude/angle"},{"location":"21_ref_api/#export-groundmeasexport","title":"Export (<code>groundmeas.export</code>)","text":"Function Description Key args/notes <code>export_measurements_to_json(path, **filters)</code> JSON export (filters match <code>read_measurements_by</code>). <code>export_measurements_to_csv(path, **filters)</code> One row per measurement; items as JSON string column. <code>export_measurements_to_xml(path, **filters)</code> XML with nested <code>&lt;items&gt;</code>."},{"location":"21_ref_api/#matplotlib-plots-groundmeasplots","title":"Matplotlib Plots (<code>groundmeas.plots</code>)","text":"Function Description Key args/notes <code>plot_imp_over_f(measurement_ids, normalize_freq_hz=None)</code> |Z| vs frequency (optional normalization). <code>plot_rho_f_model(measurement_ids, rho_f, rho=100)</code> Measured vs rho\u2013f model curves. <code>rho</code>: single or list <code>plot_voltage_vt_epr(measurement_ids, frequency=50)</code> Bars for EPR/Vtp/Vt. <code>plot_value_over_distance(measurement_ids, measurement_type=\"earthing_impedance\")</code> Value vs distance."},{"location":"21_ref_api/#plotly-groundmeasvis_plotly","title":"Plotly (<code>groundmeas.vis_plotly</code>)","text":"Function Description Key args/notes <code>plot_imp_over_f_plotly(...)</code> Interactive |Z| vs frequency. <code>plot_rho_f_model_plotly(...)</code> Measured + rho\u2013f model curves. <code>plot_voltage_vt_epr_plotly(...)</code> Bars for EPR/Vtp/Vt. <code>plot_value_over_distance_plotly(..., show_all_frequencies=False, target_frequency=None)</code> Distance plots; optionally split by frequency."},{"location":"21_ref_api/#maps-groundmeasmap_vis","title":"Maps (<code>groundmeas.map_vis</code>)","text":"Function Description Key args/notes <code>generate_map(measurements, output_file=\"measurements_map.html\", open_browser=True)</code> Folium map for measurements with valid GPS."},{"location":"21_ref_api/#ocr-import-groundmeasvision_import","title":"OCR Import (<code>groundmeas.vision_import</code>)","text":"Function Description Key args/notes <code>_normalize_number</code>, <code>_parse_value_angle_unit</code>, <code>_read_api_key</code>, <code>_image_to_base64</code>, <code>preprocess_image</code> Internal helpers. <code>ocr_image(path, lang=\"eng\", provider_model=\"tesseract\"| \"openai:&lt;model&gt;\"| \"ollama:&lt;model&gt;\", api_key_env=\"OPENAI_API_KEY\", timeout=120, max_dim=1400)</code> Run OCR. <code>parse_measurement_rows(text)</code> Extract distance\u2013current\u2013voltage\u2013impedance rows; normalize units; infer impedance if possible. <code>_relative_spread(values)</code>, <code>_interpolate_at_distance(rows, target)</code> Helper calculations. <code>build_items_from_rows(measurement_id, rows, measurement_type, frequency_hz, distance_to_current_injection_m=None)</code> Assemble payloads for impedance, earthing currents, prospective touch voltage near 1 m. <code>import_items_from_images(images_dir, measurement_id, measurement_type=\"earthing_impedance\", frequency_hz=50, distance_to_current_injection_m=None, ocr_provider=\"tesseract\", api_key_env=\"OPENAI_API_KEY\", ocr_timeout=120, ocr_max_dim=1400)</code> Batch OCR import; returns summary (<code>created_item_ids</code>, <code>skipped</code>, <code>parsed_row_count</code>)."},{"location":"21_ref_api/#cli-helpers-groundmeascli","title":"CLI helpers (<code>groundmeas.cli</code>)","text":"Function Description Key args/notes <code>_resolve_db</code>, <code>_save_default_db</code> DB path resolution and persistence. <code>_prompt_text</code>, <code>_prompt_float</code>, <code>_prompt_choice</code> Prompt helpers (prompt_toolkit). <code>_measurement_types</code>, <code>_existing_locations</code>, <code>_existing_measurement_values</code>, <code>_existing_item_units</code>, <code>_existing_item_values</code> Suggestion helpers from DB. <code>_load_measurement</code>, <code>_load_item</code>, <code>_dump_or_print</code>, <code>_print_measurement_summary</code> ID loading, JSON output, console summary. <code>_main</code> Entry point for <code>python -m groundmeas.cli</code>."},{"location":"21_ref_api/#dashboard-groundmeasdashboard","title":"Dashboard (<code>groundmeas.dashboard</code>)","text":"Function Description Key args/notes <code>resolve_db_path()</code> Resolve DB path from env/config/default. <code>init_db()</code> Connect DB; show errors in UI. <code>main()</code> Streamlit app layout (map, selection, tabs)."},{"location":"21_ref_api/#extension","title":"Extension","text":"<p>No additional extension modules; all analytics are in <code>groundmeas.services.analytics</code>.</p>"},{"location":"22_ref_cli/","title":"CLI Reference (gm-cli)","text":"<p>All commands accept <code>--db PATH</code> (or <code>GROUNDMEAS_DB</code> or <code>~/.config/groundmeas/config.json</code>). Default DB is <code>./groundmeas.db</code>.</p>"},{"location":"22_ref_cli/#data-management","title":"Data management","text":"Command Description Key arguments <code>add-measurement</code> Interactive wizard to create a measurement and items. none <code>list-measurements</code> Summary list <code>[id] location \\| method \\| asset \\| items</code>. none <code>edit-measurement MEAS_ID</code> Interactive edit with current values prefilled. <code>MEAS_ID</code> <code>delete-measurement MEAS_ID</code> Delete measurement and items. <code>--yes/-y</code> to skip prompt <code>add-item MEAS_ID</code> Add one item (magnitude/angle or real/imag; distance optional). <code>MEAS_ID</code> <code>list-items MEAS_ID</code> Tabular items for a measurement. <code>--type TYPE</code> optional <code>edit-item ITEM_ID</code> Edit one item; auto-detects representation. <code>ITEM_ID</code> <code>delete-item ITEM_ID</code> Delete one item. <code>--yes/-y</code>"},{"location":"22_ref_cli/#import-export","title":"Import / Export","text":"Command Description Key arguments <code>import-json PATH</code> Import from file/folder or split pairs <code>_measurement.json</code> + <code>_items.json</code>. <code>PATH</code> <code>export-json OUT.json</code> Export measurements with items. <code>--measurement-id ID</code> (repeatable) <code>import-from-images MEAS_ID IMAGES_DIR</code> OCR import of distance\u2013current\u2013voltage\u2013impedance tables from images. <code>--type earthing_impedance|earthing_resistance</code>; <code>--frequency 50|dir</code>; <code>--ocr tesseract|openai:&lt;model&gt;|ollama:&lt;model&gt;</code>; <code>--injection-distance M</code>; <code>--json-out FILE</code>"},{"location":"22_ref_cli/#analytics","title":"Analytics","text":"Command Description Key arguments <code>distance-profile MEAS_ID</code> Reduce distance\u2013value profile to one value. <code>--type TYPE</code>; <code>--algorithm maximum|62_percent|minimum_gradient|minimum_stddev|inverse</code>; <code>--window N</code>; <code>--json-out FILE</code> <code>impedance-over-frequency MEAS_ID...</code> Map of freq \u2192 Z <code>real-imag-over-frequency MEAS_ID...</code> Map of freq \u2192 {real, imag}. <code>--json-out FILE</code> <code>rho-f-model MEAS_ID...</code> Fit rho\u2013f coefficients. <code>--json-out FILE</code> <code>voltage-vt-epr MEAS_ID...</code> EPR and touch voltages per ampere. <code>--frequency F</code>; <code>--json-out FILE</code> <code>shield-currents LOCATION_ID</code> List shield currents at a location. <code>--frequency F</code>; <code>--json-out FILE</code> <code>calculate-split-factor</code> Compute split factor and local earthing current. <code>--earth-fault-id ITEM_ID</code>; <code>--shield-id ITEM_ID</code> (repeatable); <code>--json-out FILE</code>"},{"location":"22_ref_cli/#plotting","title":"Plotting","text":"Command Description Key arguments <code>plot-impedance MEAS_ID...</code> Matplotlib Z <code>plot-rho-f-model MEAS_ID...</code> Overlay measured vs rho\u2013f model. <code>--rho-f k1 k2 k3 k4 k5</code>; <code>--rho RHO</code> (repeatable); <code>--out FILE</code> <code>plot-voltage-vt-epr MEAS_ID...</code> Bars for EPR/Vtp/Vt. <code>--frequency F</code>; <code>--out FILE</code>"},{"location":"22_ref_cli/#maps-and-dashboard","title":"Maps and dashboard","text":"Command Description Key arguments <code>map</code> Generate Folium map. <code>--measurement-id ID</code> (repeatable); <code>--out FILE</code>; <code>--open-browser/--no-open-browser</code> <code>dashboard</code> Launch Streamlit dashboard. none"},{"location":"22_ref_cli/#configuration","title":"Configuration","text":"Command Description Key arguments <code>set-default-db PATH</code> Store default DB path in <code>~/.config/groundmeas/config.json</code>. <code>PATH</code> <p>Use <code>--help</code> with any command for full option details. <code>--json-out FILE</code> writes structured output where available.</p>"},{"location":"99_contributing/","title":"Contributing to groundmeas","text":"<p>We welcome contributions! Here's how you can help.</p>"},{"location":"99_contributing/#development-setup","title":"Development Setup","text":"<ol> <li> <p>Clone the repository:     <pre><code>git clone https://github.com/Ce1ectric/groundmeas.git\ncd groundmeas\n</code></pre></p> </li> <li> <p>Install dependencies (using Poetry):     <pre><code>poetry install\n</code></pre></p> </li> <li> <p>Activate the environment:     <pre><code>poetry shell\n</code></pre></p> </li> </ol>"},{"location":"99_contributing/#running-tests","title":"Running Tests","text":"<p>We use <code>pytest</code> for testing.</p> <pre><code>pytest\n</code></pre>"},{"location":"99_contributing/#building-documentation","title":"Building Documentation","text":"<p>We use <code>mkdocs</code> with <code>mkdocstrings</code> for documentation.</p> <ol> <li> <p>Install doc dependencies:     <pre><code>poetry add -D mkdocs mkdocs-material mkdocstrings[python]\n</code></pre></p> </li> <li> <p>Serve documentation locally:     <pre><code>mkdocs serve\n</code></pre>     Open <code>http://127.0.0.1:8000</code> in your browser.</p> </li> <li> <p>Build static site:     <pre><code>mkdocs build\n</code></pre></p> </li> </ol>"},{"location":"99_contributing/#release-process","title":"Release Process","text":"<p>Use the included script to release a new version:</p> <pre><code>python scripts/release.py\n</code></pre>"}]}